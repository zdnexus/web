<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

</body>
<script>
    // 作用域链
    // 当代码在一个环境中执行时，会创建变量对象的一个作用域链（scope chain）。用域链的用途，是保证对执行环境有权访问的所有变量和函数的有序访问。

    // 作用域链的前端，始终都是当前执行的代码所在环境的变量对象。如果这个环境是函数，则将其活动对象（activation object）作为变量对象。
    // 活动对象在最开始时只包含一个变量，即 arguments 对象（这个对象在全局环境中是不存在的）。

    // 作用域链中的下一个变量对象来自包含（外部）环境，而再下一个变量对象则来自下一个包含环境。
    // 这样，一直延续到全局执行环境；全局执行环境的变量对象始终都是作用域链中的最后一个对象。
    // 标识符解析是沿着作用域链一级一级地搜索标识符的过程。
    // 搜索过程始终从作用域链的前端开始，然后逐级地向后回溯，直至找到标识符为止（如果找不到标识符，通常会导致错误发生）。

    // 函数 changeColor() 的作用域链包含两个对象：它自己的变量对象（其中定义着 arguments 对象）和全局环境的变量对象。
    // 可以在函数内部访问变量 color，就是因为可以在这个作用域链中找到它。
    var color = "blue";
    function f1(){
        if (color === "blue"){
            color = "red";
        } else {
            color = "blue";
        }
    }
    console.log(f1());

    color = "blue";
    // f2() 的局部环境中有一个名为 anotherColor 的变量和一个名为 f3() 的函数，但它也可以访问全局环境中的变量 color。
    function f2(){
        var anotherColor = "red";
        // f3() 的局部环境中有一个变量 tempColor，该变量只能在这个环境中访问到。
        function f3(){
            var tempColor = anotherColor;
            anotherColor = color;
            color = tempColor;
            // 这里可以访问color、anotherColor 和 tempColor
        }
        // 无论全局环境还是 f2() 的局部环境都无权访问 tempColor。
        // 然而，在 f3() 内部则可以访问其他两个环境中的所有变量，因为那两个环境是它的父执行环境。
        // 这里可以访问 color 和 anotherColor ，但不能访问tempColor
        f3();
    }
    // 这里只能访问color
    f2();
    // 内部环境可以通过作用域链访问所有的外部环境，但外部环境不能访问内部环境中的任何变量和函数。
    // 这些环境之间的联系是线性、有次序的。每个环境都可以向上搜索作用域链，以查询变量和函数名；
    // 但任何环境都不能通过向下搜索作用域链而进入另一个执行环境。
    // f3() 的局部环境开始时会先在自己的变量对象中搜索变量和函数名，如果搜索不到则再搜索上一级作用域链。
    // f2() 的作用域链中只包含两个对象：它自己的变量对象和全局变量对象。这也就是说，它不能访问 f3() 的环境。
    // 函数参数也被当作变量来对待，因此其访问规则与执行环境中的其他变量相同。
</script>
</html>